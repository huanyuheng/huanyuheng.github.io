---
layout: post
title: å»ºç«‹ç¬”è®°æ–¹æ³•
date: 2025-12-07 21:00:46 +0800
tags: [111]
---

å¯ä»¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä½ åšä¸€ä¸ª**ç®€æ˜“ç‰ˆâ€œåå° /adminâ€ é¡µé¢**ï¼š

> ä»¥åä½ ï¼š
>
> 1. æ‰“å¼€ `https://huanyuheng.com/admin/`
> 2. åœ¨ç½‘é¡µé‡Œå†™æ ‡é¢˜ + æ­£æ–‡
> 3. ç‚¹ã€Œå‘å¸ƒã€
>    ğŸ‘‰ ç½‘é¡µç”¨ GitHub API ç›´æ¥æŠŠæ–‡ç« æäº¤åˆ° `huanyuheng.github.io` ä»“åº“çš„ `_posts` é‡Œï¼Œç›¸å½“äºè‡ªåŠ¨ Git commitã€‚

å®Œå…¨é™æ€ï¼Œä¸éœ€è¦æœåŠ¡å™¨ï¼ŒPAT åªå­˜åœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨é‡Œã€‚

æˆ‘ä¸€æ­¥æ­¥ç»™ä½ é…å¥½ï¼ˆå»ºè®®è¾¹çœ‹è¾¹åšï¼‰ï¼š

---

## ç¬¬ 0 æ­¥ï¼šå‡†å¤‡ GitHub Tokenï¼ˆåªä½ è‡ªå·±çŸ¥é“ï¼‰

1. è¿› GitHub â†’ å³ä¸Šè§’å¤´åƒ â†’ **Settings**
2. å·¦ä¾§æœ€ä¸‹é¢ **Developer settings â†’ Personal access tokens â†’ Tokens (classic)**
3. New token

   * Note éšä¾¿å†™ï¼š`blog-admin`
   * é€‰æ‹©æƒé™ï¼šå‹¾ **repo**ï¼ˆæ•´ç»„å‹¾ä¸Šå°±è¡Œï¼‰
4. ç”Ÿæˆåå¤åˆ¶é‚£ä¸² tokenï¼ˆå¾ˆé•¿çš„ä¸€ä¸²ï¼‰ã€‚

> è¿™ä¸² token ç›¸å½“äºä½ æ‰‹é‡Œçš„é’¥åŒ™ï¼š**ä¸è¦ç»™åˆ«äººçœ‹**ï¼Œä¸è¦åœ¨å…¬å…±ç”µè„‘ä¸Šç”¨ã€‚

---

## ç¬¬ 1 æ­¥ï¼šæ–°å»ºåå°é¡µé¢ admin.html

åœ¨ä½ çš„ä»“åº“æ ¹ç›®å½•æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼š`admin.html`
å†…å®¹ç›´æ¥å¤åˆ¶ä¸‹é¢è¿™æ®µï¼ˆOWNER/REPO æˆ‘å·²ç»ç»™ä½ å†™å¥½äº†ï¼‰ï¼š

```html
---
layout: page
title: åå°å‘å¸ƒ
permalink: /admin/
---

<div class="page admin-page">
  <h1>å‘å¸ƒæ–°æ–‡ç« </h1>

  <p style="color:#6b7280;font-size:14px;">
    ç¬¬ä¸€æ¬¡ä½¿ç”¨å…ˆåœ¨ä¸‹é¢è¾“å…¥ä½ çš„ GitHub Tokenï¼Œç‚¹å‡»â€œä¿å­˜ Tokenï¼ˆåªä¿å­˜åœ¨æœ¬æœºï¼‰â€ã€‚
    ä¹‹åå°±å¯ä»¥ç›´æ¥åœ¨ç½‘é¡µé‡Œå†™æ–‡ç« ï¼Œä¸€é”®åŒæ­¥åˆ°ä»“åº“çš„ <code>_posts</code>ã€‚
  </p>

  <div style="margin:16px 0;padding:12px 14px;border-radius:10px;background:#f9fafb;border:1px solid #e5e7eb;">
    <label style="font-size:14px;color:#374151;">GitHub Token</label><br>
    <input id="token-input" type="password" style="margin-top:6px;width:100%;max-width:420px;padding:8px 10px;border-radius:8px;border:1px solid #d1d5db;">
    <button id="save-token" style="margin-left:8px;padding:8px 14px;border-radius:999px;border:none;background:#2563eb;color:#fff;font-size:14px;cursor:pointer;">
      ä¿å­˜ Tokenï¼ˆåªä¿å­˜åœ¨æœ¬æœºï¼‰
    </button>
    <span id="token-status" style="margin-left:8px;font-size:13px;color:#16a34a;"></span>
  </div>

  <hr style="margin:18px 0 20px 0;border:none;border-top:1px solid #e5e7eb;">

  <form id="post-form">
    <div style="margin-bottom:12px;">
      <label>æ ‡é¢˜ï¼ˆtitleï¼‰</label><br>
      <input id="post-title" type="text" required
             style="margin-top:4px;width:100%;max-width:420px;padding:8px 10px;border-radius:8px;border:1px solid #d1d5db;">
    </div>

    <div style="margin-bottom:12px;">
      <label>æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰</label><br>
      <input id="post-date" type="text"
             style="margin-top:4px;width:160px;padding:8px 10px;border-radius:8px;border:1px solid #d1d5db;">
    </div>

    <div style="margin-bottom:12px;">
      <label>æ–‡ä»¶åä¸­çš„ slugï¼ˆå¯ç©ºï¼Œä¾‹å¦‚ my-first-postï¼‰</label><br>
      <input id="post-slug" type="text"
             style="margin-top:4px;width:100%;max-width:420px;padding:8px 10px;border-radius:8px;border:1px solid #d1d5db;">
      <div style="font-size:12px;color:#6b7280;margin-top:2px;">
        æœ€ç»ˆæ–‡ä»¶åä¼šæ˜¯ï¼š<code>YYYY-MM-DD-slug.md</code>ï¼Œä¸å†™å°±è‡ªåŠ¨ç”¨æ—¶é—´æˆ³ã€‚
      </div>
    </div>

    <div style="margin-bottom:12px;">
      <label>æ ‡ç­¾ï¼ˆtagsï¼Œç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼Œå¯é€‰ï¼‰</label><br>
      <input id="post-tags" type="text"
             placeholder="gamma-ray, metasurface"
             style="margin-top:4px;width:100%;max-width:420px;padding:8px 10px;border-radius:8px;border:1px solid #d1d5db;">
    </div>

    <div style="margin-bottom:12px;">
      <label>æ­£æ–‡å†…å®¹ï¼ˆæ”¯æŒ Markdownï¼‰</label><br>
      <textarea id="post-body" rows="18"
                style="margin-top:4px;width:100%;max-width:100%;padding:10px 12px;border-radius:10px;border:1px solid #d1d5db;font-family:monospace,Consolas,Menlo;"></textarea>
    </div>

    <button type="submit"
            style="padding:10px 24px;border-radius:999px;border:none;background:#16a34a;color:#fff;font-size:15px;font-weight:600;cursor:pointer;">
      ğŸš€ å‘å¸ƒåˆ° GitHub
    </button>
    <span id="post-status" style="margin-left:10px;font-size:14px;color:#6b7280;"></span>
  </form>
</div>

<script>
  // ===== åŸºæœ¬é…ç½® =====
  const OWNER = "huanyuheng";
  const REPO  = "huanyuheng.github.io";
  const BRANCH = "main"; // å¦‚æœä»¥åä¸æ˜¯ mainï¼Œå¯ä»¥æ”¹è¿™é‡Œ

  const TOKEN_KEY = "blog_admin_token";

  function getToken() {
    return localStorage.getItem(TOKEN_KEY) || "";
  }

  function setToken(token) {
    localStorage.setItem(TOKEN_KEY, token);
  }

  // åˆå§‹åŒ–ï¼šå¦‚æœæœ¬åœ°å·²æœ‰ tokenï¼Œç»™ä¸ªæç¤º
  const tokenInput  = document.getElementById("token-input");
  const tokenStatus = document.getElementById("token-status");

  if (getToken()) {
    tokenStatus.textContent = "å·²åœ¨æœ¬æœºä¿å­˜ Token";
  }

  document.getElementById("save-token").onclick = function () {
    const t = tokenInput.value.trim();
    if (!t) {
      alert("è¯·å…ˆç²˜è´´ GitHub Token");
      return;
    }
    setToken(t);
    tokenStatus.style.color = "#16a34a";
    tokenStatus.textContent = "Token å·²ä¿å­˜ï¼ˆä»…æœ¬æœºæµè§ˆå™¨ï¼‰";
    tokenInput.value = "";
  };

  // é»˜è®¤æ—¥æœŸï¼šä»Šå¤©
  const dateInput = document.getElementById("post-date");
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, "0");
  const dd = String(today.getDate()).padStart(2, "0");
  dateInput.value = `${yyyy}-${mm}-${dd}`;

  // è¡¨å•æäº¤ï¼šè°ƒç”¨ GitHub API åˆ›å»º _posts é‡Œçš„æ–‡ä»¶
  document.getElementById("post-form").addEventListener("submit", async function (e) {
    e.preventDefault();

    const token = getToken();
    if (!token) {
      alert("è¯·å…ˆåœ¨ä¸Šé¢ä¿å­˜ GitHub Tokenã€‚");
      return;
    }

    const title = document.getElementById("post-title").value.trim();
    const date  = document.getElementById("post-date").value.trim();
    let slug    = document.getElementById("post-slug").value.trim();
    const tagsStr = document.getElementById("post-tags").value.trim();
    const body  = document.getElementById("post-body").value;

    if (!title || !date || !body) {
      alert("æ ‡é¢˜ / æ—¥æœŸ / æ­£æ–‡æ˜¯å¿…å¡«çš„ã€‚");
      return;
    }

    // ç”Ÿæˆ slug
    if (!slug) {
      slug = "post-" + Date.now();
    }

    const filename = `${date}-${slug}.md`;
    const path = `_posts/${filename}`;

    // tags: ç”¨é€—å·åˆ†éš”
    let tagsYaml = "";
    if (tagsStr) {
      const arr = tagsStr.split(",").map(s => s.trim()).filter(Boolean);
      if (arr.length > 0) {
        tagsYaml = "tags: [" + arr.join(", ") + "]\n";
      }
    }

    // ç”Ÿæˆ Jekyll front-matter
    const now = new Date();
    const hh = String(now.getHours()).padStart(2, "0");
    const mi = String(now.getMinutes()).padStart(2, "0");
    const ss = String(now.getSeconds()).padStart(2, "0");
    const dateTime = `${date} ${hh}:${mi}:${ss} +0800`;

    const frontMatter =
`---
layout: post
title: ${JSON.stringify(title).slice(1,-1)}
date: ${dateTime}
${tagsYaml}---
`;

    const fullContent = frontMatter + "\n" + body + "\n";

    const b64 = btoa(unescape(encodeURIComponent(fullContent)));

    const statusSpan = document.getElementById("post-status");
    statusSpan.style.color = "#6b7280";
    statusSpan.textContent = "æ­£åœ¨æäº¤åˆ° GitHubâ€¦";

    try {
      const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(path)}`, {
        method: "PUT",
        headers: {
          "Authorization": "token " + token,
          "Accept": "application/vnd.github+json"
        },
        body: JSON.stringify({
          message: `Add post ${filename}`,
          content: b64,
          branch: BRANCH
        })
      });

      const data = await res.json();

      if (res.status === 201 || res.status === 200) {
        statusSpan.style.color = "#16a34a";
        statusSpan.textContent = "å‘å¸ƒæˆåŠŸï¼GitHub Pages æ­£åœ¨é‡æ–°æ„å»ºã€‚";
        console.log("GitHub è¿”å›ï¼š", data);
      } else {
        console.error("GitHub error:", data);
        statusSpan.style.color = "#dc2626";
        statusSpan.textContent = "æäº¤å¤±è´¥ï¼Œæ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ã€‚";
        alert("æäº¤å¤±è´¥ï¼š" + (data.message || res.status));
      }
    } catch (err) {
      console.error(err);
      statusSpan.style.color = "#dc2626";
      statusSpan.textContent = "ç½‘ç»œæˆ–å…¶å®ƒé”™è¯¯ã€‚";
      alert("ç½‘ç»œæˆ–å…¶å®ƒé”™è¯¯ï¼Œè¯·ç¨åå†è¯•ã€‚");
    }
  });
</script>
```

> è¯´æ˜ï¼š
>
> * Token ç”¨ `localStorage` å­˜åœ¨ä½ è‡ªå·±çš„æµè§ˆå™¨é‡Œï¼Œä¸ä¼šå†™è¿›ä»“åº“ï¼›
> * é¡µé¢ä¼šç›´æ¥è°ƒç”¨ GitHub APIï¼ŒæŠŠæ–‡ç« ä½œä¸ºæ–°æ–‡ä»¶æ¨åˆ° `_posts/`ï¼›
> * æ–‡ä»¶åè‡ªåŠ¨æŒ‰ `YYYY-MM-DD-slug.md` æ ¼å¼ç”Ÿæˆï¼ŒJekyll èƒ½æ­£å¸¸è¯†åˆ«ã€‚

---

## ç¬¬ 2 æ­¥ï¼šGitHub Pages è‡ªåŠ¨æ„å»º

ä½ ä¸€ä¿å­˜ `admin.html` ä¹‹åï¼ŒGitHub ä¼šè‡ªåŠ¨æ„å»ºã€‚
æ„å»ºæˆåŠŸåè®¿é—®ï¼š

> `https://huanyuheng.com/admin/`

å°±èƒ½çœ‹åˆ°è¿™ä¸ªåå°é¡µé¢ã€‚

**ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼š**

1. æŠŠåˆšæ‰ç”Ÿæˆçš„ GitHub Token ç²˜è´´åˆ°æœ€ä¸Šé¢çš„è¾“å…¥æ¡† â†’ ç‚¹ã€Œä¿å­˜ Tokenã€
2. å¡«æ ‡é¢˜ / æ—¥æœŸ / slug / tags / æ­£æ–‡ â†’ ç‚¹ã€Œå‘å¸ƒåˆ° GitHubã€
3. ç­‰å‡ åç§’ï¼Œåšå®¢é¦–é¡µå°±ä¼šå‡ºç°æ–°æ–‡ç« ã€‚

---

## ä½¿ç”¨æ³¨æ„ï¼ˆå®‰å…¨ç›¸å…³ï¼‰

* è¿™ä¸ªåå°**åªç»™ä½ è‡ªå·±ç”¨**ï¼Œç½‘å€ä¸è¦ä¹±å‘ï¼›
* Token æœ‰ä»“åº“å†™æƒé™ï¼Œ**ä¸è¦åœ¨å…¬å…±ç”µè„‘ã€ç½‘å§ç­‰åœ°æ–¹ä¿å­˜ Token**ï¼›
* å¦‚æœå“ªå¤© Token æ³„éœ²æˆ–ç”µè„‘æ¢äº†ï¼Œå» GitHub æŠŠè¿™ä¸ª Token revoke æ‰ï¼Œå†é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ã€‚

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘è¿˜èƒ½å¸®ä½ ï¼š

* åšä¸€ä¸ªã€Œæ–‡ç« åˆ—è¡¨ã€+ã€Œç¼–è¾‘å·²æœ‰æ–‡ç« ã€åŠŸèƒ½ï¼›
* è®©åå°çš„ UI å’Œç°åœ¨çš„åšå®¢é£æ ¼æ›´ç»Ÿä¸€ï¼ˆå¤ç”¨ä½ çš„å¡ç‰‡æ ·å¼ï¼‰ï¼›
* æŠŠè¿™ä¸ªè¿‡ç¨‹å†å†™ä¸€ç¯‡è¯¦ç»†æ•™ç¨‹æ–‡ç« å‘åˆ°ä½ çš„åšå®¢é‡Œ ğŸ˜„ã€‚
